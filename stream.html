<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Local Video Watch Party</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
  <style>
    body { font-family: system-ui, sans-serif; background:#111; color:#eee; padding:20px }
    video { width:100%; max-width:900px; background:black }
    .box { margin-top:16px }
    input, button { padding:8px; margin-top:8px }
    code { background:#222; padding:4px 6px }
  </style>
</head>
<body>
  <h1>ðŸ“º Local File Watch Party</h1>

  <div class="box">
    <strong>1. Host:</strong> Choose a video file
    <br />
    <input type="file" id="fileInput" accept="video/*" />
  </div>

  <div class="box">
    <strong>2. Share this Room ID:</strong>
    <div><code id="roomId">(generatingâ€¦)</code></div>
  </div>

  <div class="box">
    <strong>3. Join a room:</strong>
    <br />
    <input id="joinId" placeholder="Enter room ID" />
    <button onclick="joinRoom()">Join</button>
  </div>

  <video id="video" controls></video>

<script>
const video = document.getElementById('video');
const roomIdEl = document.getElementById('roomId');
let connections = [];

// Create peer (uses free PeerJS signaling server)
const peer = new Peer();

peer.on('open', id => {
  roomIdEl.textContent = id;
});

peer.on('connection', conn => {
  setupConnection(conn);
});

function joinRoom() {
  const id = document.getElementById('joinId').value.trim();
  if (!id) return;
  const conn = peer.connect(id);
  setupConnection(conn);
}

function setupConnection(conn) {
  conn.on('open', () => {
    connections.push(conn);
  });

  conn.on('data', msg => {
    if (msg.type === 'play') video.play();
    if (msg.type === 'pause') video.pause();
    if (msg.type === 'seek') video.currentTime = msg.time;
  });
}

function broadcast(msg) {
  connections.forEach(c => c.send(msg));
}

// Sync controls
video.addEventListener('play', () => broadcast({ type: 'play' }));
video.addEventListener('pause', () => broadcast({ type: 'pause' }));
video.addEventListener('seeked', () => broadcast({ type: 'seek', time: video.currentTime }));

// Load local file (host only)
document.getElementById('fileInput').addEventListener('change', e => {
  const file = e.target.files[0];
  if (file) {
    video.src = URL.createObjectURL(file);
  }
});
</script>
</body>
</html>
